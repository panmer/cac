(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{46:function(e,s,t){},47:function(e,s,t){},52:function(e,s,t){},56:function(e,s,t){},98:function(e,s,t){"use strict";t.r(s);t(45),t(46),t(47);var a=t(1),n=t(10),c=t.n(n),r=t(103),o=(t(52),t(0));const l=["User1","User2","User3","User4"];function i(e){let{onLogIn:s}=e;const[t,n]=Object(a.useState)((()=>l[Math.floor(Math.random()*l.length)])),[c,i]=Object(a.useState)(null),[m,u]=Object(a.useState)("password123");return Object(o.jsx)(o.Fragment,{children:Object(o.jsx)("div",{className:"login-form text-center login-page",children:Object(o.jsxs)("div",{className:"rounded",style:{boxShadow:"0 0.75rem 1.5rem rgba(18,38,63,.03)"},children:[Object(o.jsxs)("div",{className:"position-relative",children:[Object(o.jsxs)("div",{className:"row no-gutters align-items-center",style:{maxWidth:400,backgroundColor:"palegreen",padding:20},children:[Object(o.jsxs)("div",{className:"col text-primary text-left",children:[Object(o.jsx)("h3",{className:"font-size-15",children:"Spring Redis Chat App!"}),"Password:\xa0",Object(o.jsx)("i",{children:"password123"})]}),Object(o.jsx)("div",{className:"col align-self-end",children:Object(o.jsx)("img",{style:{maxWidth:"80%"},src:"".concat("","/welcome-back.png")})})]}),Object(o.jsx)("div",{className:"position-absolute",style:{bottom:-10,left:20}})]}),Object(o.jsxs)("form",{className:"bg-white text-left px-4",style:{paddingTop:20,borderBottomLeftRadius:4,borderBottomRightRadius:4},onSubmit:async e=>{e.preventDefault(),s(t,m,i)},children:[Object(o.jsx)("label",{className:"font-size-12",children:"Name"}),Object(o.jsx)("div",{className:"username-select mb-3",children:Object(o.jsx)(d,{username:t,setUsername:n,names:l})}),Object(o.jsx)("label",{htmlFor:"inputPassword",className:"font-size-12",children:"Password"}),Object(o.jsx)("input",{value:"password123",onChange:e=>u(e.target.value),type:"password",id:"inputPassword",className:"form-control",required:!0}),Object(o.jsx)("div",{style:{height:30}}),Object(o.jsx)("button",{className:"btn btn-lg btn-primary btn-block",type:"submit",children:"Sign in"}),Object(o.jsx)("div",{className:"login-error-anchor",children:Object(o.jsx)("div",{className:"toast-box",children:Object(o.jsxs)(r.a,{style:{minWidth:277},onClose:()=>i(null),show:null!==c,delay:3e3,autohide:!0,children:[Object(o.jsxs)(r.a.Header,{children:[Object(o.jsx)("img",{src:"holder.js/20x20?text=%20",className:"rounded mr-2",alt:""}),Object(o.jsx)("strong",{className:"mr-auto",children:"Error"})]}),Object(o.jsx)(r.a.Body,{children:c})]})})}),Object(o.jsx)("div",{style:{height:30}})]})]})})})}const d=e=>{var s;let{username:t,setUsername:n,names:c=[""]}=e;const[r,l]=Object(a.useState)(!1),[i,d]=Object(a.useState)(0),m=Object(a.useRef)(),u=null===(s=m.current)||void 0===s?void 0:s.getBoundingClientRect().width;return Object(a.useEffect)((()=>{d(u)}),[u]),Object(a.useEffect)((()=>{if(r){const e=()=>l(!1);return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}}),[r]),Object(a.useEffect)((()=>{var e;r&&(null===(e=m.current)||void 0===e||e.focus())}),[r]),Object(o.jsxs)("div",{tabIndex:0,ref:m,className:"username-select-dropdown ".concat(r?"open":""),onClick:()=>l((e=>!e)),children:[Object(o.jsxs)("div",{className:"username-select-row",children:[Object(o.jsx)("div",{children:t}),Object(o.jsx)("div",{children:Object(o.jsx)("svg",{width:24,height:24,children:Object(o.jsx)("path",{d:"M7 10l5 5 5-5z",fill:"#333"})})})]}),Object(o.jsx)("div",{style:{width:i},className:"username-select-block ".concat(r?"open":""),children:c.map((e=>Object(o.jsx)("div",{className:"username-select-block-item",onClick:()=>n(e),children:e},e)))})]})};t(56);const m=(e,s)=>{switch(s.type){case"clear":return{currentRoom:"0",rooms:{},users:{}};case"set user":return{...e,users:{...e.users,[s.payload.id]:s.payload}};case"make user online":return{...e,users:{...e.users,[s.payload]:{...e.users[s.payload],online:!0}}};case"append users":return{...e,users:{...e.users,...s.payload}};case"set messages":return{...e,rooms:{...e.rooms,[s.payload.id]:{...e.rooms[s.payload.id],messages:s.payload.messages,offset:s.payload.messages.length}}};case"prepend messages":{const t=[...s.payload.messages,...e.rooms[s.payload.id].messages];return{...e,rooms:{...e.rooms,[s.payload.id]:{...e.rooms[s.payload.id],messages:t,offset:t.length}}}}case"append message":return void 0===e.rooms[s.payload.id]?e:{...e,rooms:{...e.rooms,[s.payload.id]:{...e.rooms[s.payload.id],lastMessage:s.payload.message,messages:e.rooms[s.payload.id].messages?[...e.rooms[s.payload.id].messages,s.payload.message]:void 0}}};case"set last message":return{...e,rooms:{...e.rooms,[s.payload.id]:{...e.rooms[s.payload.id],lastMessage:s.payload.lastMessage}}};case"set current room":return{...e,currentRoom:s.payload};case"add room":return{...e,rooms:{...e.rooms,[s.payload.id]:s.payload}};case"set rooms":{const t=s.payload,a={...e.rooms};return t.forEach((e=>{a[e.id]={...e,messages:a[e.id]&&a[e.id].messages}})),{...e,rooms:a}}default:return e}},u={currentRoom:"main",rooms:{},users:{}},j=Object(a.createContext)(),b=()=>{const[e,s]=Object(a.useContext)(j);return[e,s]};var h=()=>Object(a.useReducer)(m,u),g=t(9),p=t.n(g),x=t(6),O=t.n(x);O.a.defaults.withCredentials=!0;function f(e){return"".concat("http://localhost:8080").concat(e)}const v=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return O.a.get(f("/rooms/messages/".concat(e)),{params:{offset:s,size:t}}).then((e=>e.data.reverse()))},y=(e,s)=>{for(let t of e)if("string"!==typeof t&&(t=t[0]),t!==s)return t;return e[0]},N=(t(76),async(e,s,t)=>{const a={};t.forEach((e=>{a[e.from]=1}));const n=Object.keys(a).filter((s=>void 0===e[s]));if(0!==n.length){const e=await(e=>O.a.get(f("/users"),{params:{ids:e.reduce(((e,s)=>"".concat(e,",").concat(s)))}}).then((e=>e.data)))(n);s({type:"append users",payload:e})}});var w=()=>Object(o.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 1651 1651",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Object(o.jsx)("rect",{width:"1651",height:"1651",rx:"14",fill:"white"}),Object(o.jsx)("path",{d:"M495.286 1098.96L497.967 1070.86L478.04 1050.88C408.572 981.233 368 891.771 368 795.344C368 585.371 565.306 402 826 402C1086.69 402 1284 585.371 1284 795.344C1284 1005.32 1086.69 1188.69 826 1188.69V1248.69L825.913 1188.69C779.837 1188.75 733.952 1182.77 689.432 1170.9L667.26 1164.98L646.8 1175.37C620.731 1188.61 562.74 1213.98 467.32 1235.35C480.554 1191.83 490.95 1144.39 495.286 1098.96Z",stroke:"url(#paint0_linear)",strokeWidth:"120"}),Object(o.jsx)("defs",{children:Object(o.jsxs)("linearGradient",{id:"paint0_linear",x1:"662.312",y1:"397.956",x2:"416.164",y2:"1678.7",gradientUnits:"userSpaceOnUse",children:[Object(o.jsx)("stop",{stopColor:"#7514FB"}),Object(o.jsx)("stop",{offset:"0.624243",stopColor:"#F26D41"}),Object(o.jsx)("stop",{offset:"1",stopColor:"#F43B4B"})]})})]});var C=e=>{let{name:s,id:t}=e;const n=Object(a.useMemo)((()=>{const e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";const s=+e.split(":").pop();let t=+e.split(":").reverse().pop();t<0&&(t+=3555);const a=(654*s+531*t)%13;return"".concat("","/avatars/").concat(a,".jpg")}(""+t);return"User1"===s?"".concat("","/avatars/0.jpg"):"User2"===s?"".concat("","/avatars/2.jpg"):"User3"===s?"".concat("","/avatars/9.jpg"):"User4"===s?"".concat("","/avatars/8.jpg"):e}),[t,s]);return Object(o.jsx)(o.Fragment,{children:"General"!==s?Object(o.jsx)("img",{src:n,alt:s,style:{width:32,height:32,objectFit:"cover"},className:"rounded-circle avatar-xs"}):Object(o.jsx)("div",{className:"overflow-hidden rounded-circle",children:Object(o.jsx)(w,{})})})};var k=e=>{let{online:s,hide:t=!1,width:a=8,height:n=8}=e;return Object(o.jsx)("div",{className:s?"rounded-circle bg-success":"rounded-circle bg-gray",style:{width:a,height:n,opacity:t?0:1}})};const L=e=>{const{id:s,name:t}=e,[n]=b(),[c,r,o]=Object(a.useMemo)((()=>{try{let e=Math.abs(parseInt(s.split(":").reverse().pop()));const a=e>0,c=Object.entries(n.users).filter((e=>{let[,s]=e;return s.username===t})).map((e=>{let[,s]=e;return s}));let r=!1;return c.length>0&&(r=c[0].online,e=+c[0].id),[a,r,e]}catch(e){return[!1,!1,"0"]}}),[s,t,n.users]),l=M(e);return{isUser:c,online:r,userId:o,name:e.name,lastMessage:l}},M=e=>{const[,s]=b(),{lastMessage:t}=e;return Object(a.useEffect)((()=>{void 0===t&&(void 0===e.messages?v(e.id,0,1).then((t=>{let a=null;0!==t.length&&(a=t.pop()),s({type:"set last message",payload:{id:e.id,lastMessage:a}})})):0===e.messages.length?s({type:"set last message",payload:{id:e.id,lastMessage:null}}):s({type:"set last message",payload:{id:e.id,lastMessage:e.messages[e.messages.length-1]}}))}),[t,s,e]),t};var S=e=>{let{room:s,active:t=!1,onClick:a}=e;const{online:n,name:c,lastMessage:r,userId:l}=L(s);return Object(o.jsxs)("div",{onClick:a,className:"chat-list-item d-flex align-items-start rounded ".concat(t?"bg-white":""),children:[Object(o.jsx)("div",{className:"align-self-center mr-3",children:Object(o.jsx)(k,{online:n,hide:"0"===s.id})}),Object(o.jsx)("div",{className:"align-self-center mr-3",children:Object(o.jsx)(C,{name:c,id:l})}),Object(o.jsxs)("div",{className:"media-body overflow-hidden",children:[Object(o.jsx)("h5",{className:"text-truncate font-size-14 mb-1",children:c}),r&&Object(o.jsxs)("p",{className:"text-truncate mb-0",children:[" ",r.message," "]})]}),r&&Object(o.jsx)("div",{className:"font-size-11",children:p.a.unix(r.date).format("LT")})]})},E=t(101);const I=e=>{let{onLogOut:s,col:t=5,noinfo:a=!1}=e;return Object(o.jsxs)("div",{onClick:s,style:{cursor:"pointer"},className:"col-".concat(t," text-danger ").concat(a?"":"text-right"),children:[Object(o.jsx)(E.a,{})," Exit Chat"]})},R=e=>{let{user:s,col:t=7,noinfo:a=!1}=e;return Object(o.jsxs)("div",{className:"col-".concat(t," d-flex align-items-center ").concat(a?"justify-content-end":""),children:[Object(o.jsx)("div",{className:"align-self-center ".concat(a?"":"mr-3"),children:Object(o.jsx)(C,{name:s.username,id:s.id})}),!a&&Object(o.jsxs)("div",{className:"media-body",children:[Object(o.jsx)("h5",{className:"font-size-14 mt-0 mb-1",children:s.username}),Object(o.jsxs)("div",{className:"d-flex align-items-center",children:[Object(o.jsx)(k,{online:!0}),Object(o.jsx)("p",{className:"ml-2 text-muted mb-0",children:"Active"})]})]})]})};var U=e=>{let{user:s,onLogOut:t}=e;return Object(o.jsx)("div",{className:"row no-gutters align-items-center pl-4 pr-2 pb-3",style:{height:"inherit",flex:0,minHeight:50},children:Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(R,{user:s,col:8}),Object(o.jsx)(I,{onLogOut:t,col:4})]})})};var z=e=>{let{rooms:s,dispatch:t,user:n,currentRoom:c,onLogOut:r}=e;const l=Object(a.useMemo)((()=>{const e=Object.values(s),t=e.filter((e=>"0"===e.id));let a=e.filter((e=>"0"!==e.id));return a=a.sort(((e,s)=>+e.id.split(":").pop()-+s.id.split(":").pop())),[...t||[],...a]}),[s]);return Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)("div",{className:"chat-list-container flex-column d-flex pr-4",children:[Object(o.jsx)("div",{className:"messages-box flex flex-1",children:Object(o.jsx)("div",{className:"list-group rounded-0",children:l.map((e=>Object(o.jsx)(S,{onClick:()=>t({type:"set current room",payload:e.id}),active:c===e.id,room:e},e.id)))})}),Object(o.jsx)("div",{className:"py-2",children:Object(o.jsx)("p",{className:"h5 mb-0 py-1 chats-title",children:"Chats"})}),Object(o.jsx)(U,{user:n,onLogOut:r})]})})};var _=e=>{let{message:s}=e;return Object(o.jsx)("p",{className:"mb-2 fs-6 fw-light fst-italic text-black-50 text-center",style:{opacity:.8,fontSize:14},children:s})};var B=()=>Object(o.jsx)("div",{className:"no-messages flex-column d-flex flex-row justify-content-center align-items-center text-muted text-center",children:Object(o.jsx)("div",{className:"spinner-border",role:"status",children:Object(o.jsx)("span",{className:"visually-hidden"})})}),F=t(102);var T=()=>Object(o.jsxs)("div",{className:"no-messages flex-column d-flex flex-row justify-content-center align-items-center text-muted text-center",children:[Object(o.jsx)(F.a,{size:96}),Object(o.jsx)("p",{children:"No messages"})]});var H=()=>Object(o.jsxs)("svg",{width:12,height:12,className:"prefix__MuiSvgIcon-root prefix__jss80 prefix__MuiSvgIcon-fontSizeLarge",viewBox:"0 0 24 24","aria-hidden":"true",children:[Object(o.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),Object(o.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]});var W=e=>{let{username:s="user",message:t="Lorem ipsum dolor...",date:a}=e;return Object(o.jsxs)("div",{className:"d-flex",children:[Object(o.jsx)("div",{style:{flex:1}}),Object(o.jsx)("div",{style:{width:"50%"},className:"text-right mb-4",children:Object(o.jsx)("div",{className:"conversation-list d-inline-block bg-light px-3 py-2",style:{borderRadius:12},children:Object(o.jsxs)("div",{className:"ctext-wrap",children:[Object(o.jsx)("div",{className:"conversation-name text-left text-primary mb-1",style:{fontWeight:600},children:s}),Object(o.jsx)("p",{className:"text-left",children:t}),Object(o.jsxs)("p",{className:"chat-time mb-0",children:[Object(o.jsx)(H,{})," ",p.a.unix(a).format("LT")," "]})]})})})]})};var D=e=>{let{user:s,message:t="Lorem ipsum dolor...",date:a,onUserClicked:n}=e;return Object(o.jsxs)("div",{className:"d-flex",children:[Object(o.jsx)("div",{style:{width:"50%"},className:"text-left mb-4",children:Object(o.jsx)("div",{className:"conversation-list d-inline-block px-3 py-2",style:{borderRadius:12,backgroundColor:"rgba(85, 110, 230, 0.1)"},children:Object(o.jsxs)("div",{className:"ctext-wrap",children:[s&&Object(o.jsxs)("div",{className:"conversation-name d-flex align-items-center mb-1",children:[Object(o.jsx)("div",{className:"mr-2",style:{fontWeight:600,cursor:"pointer",color:"green"},onClick:n,children:s.username}),Object(o.jsx)(k,{width:7,height:7,online:s.online})]}),Object(o.jsx)("p",{className:"text-left",children:t}),Object(o.jsxs)("p",{className:"chat-time mb-0",children:[Object(o.jsx)(H,{})," ",p.a.unix(a).format("LT")," "]})]})})}),Object(o.jsx)("div",{style:{flex:1}})]})};var P=e=>{let{messageListElement:s,messages:t,room:a,onLoadMoreMessages:n,user:c,onUserClicked:r,users:l}=e;return Object(o.jsxs)("div",{ref:s,className:"chat-box-wrapper position-relative d-flex",children:[void 0===t?Object(o.jsx)(B,{}):0===t.length?Object(o.jsx)(T,{}):Object(o.jsx)(o.Fragment,{}),Object(o.jsx)("div",{className:"px-4 pt-5 chat-box position-absolute",children:t&&0!==t.length&&Object(o.jsxs)(o.Fragment,{children:[a.offset&&a.offset>=10?Object(o.jsxs)("div",{className:"d-flex flex-row align-items-center mb-4",children:[Object(o.jsx)("div",{style:{height:1,backgroundColor:"#eee",flex:1}}),Object(o.jsx)("div",{className:"mx-3",children:Object(o.jsx)("button",{"aria-haspopup":"true","aria-expanded":"true",type:"button",onClick:n,className:"btn rounded-button btn-secondary nav-btn",id:"__BVID__168__BV_toggle_",children:"Load more"})}),Object(o.jsx)("div",{style:{height:1,backgroundColor:"#eee",flex:1}})]}):Object(o.jsx)(o.Fragment,{}),t.map(((e,s)=>{const t=e.message+e.date+e.from+s;return"info"===e.from?Object(o.jsx)(_,{message:e.message},t):+e.from!==+c.id?Object(o.jsx)(D,{onUserClicked:()=>r(e.from),message:e.message,date:e.date,user:l[e.from]},t):Object(o.jsx)(W,{username:l[e.from]?l[e.from].username:"",message:e.message,date:e.date},t)}))]})})]})};var G=e=>{let{message:s,setMessage:t,onSubmit:a}=e;return Object(o.jsx)("div",{className:"p-3 chat-input-section",children:Object(o.jsxs)("form",{className:"row",onSubmit:a,children:[Object(o.jsx)("div",{className:"col",children:Object(o.jsx)("div",{className:"position-relative",children:Object(o.jsx)("input",{value:s,onChange:e=>t(e.target.value),type:"text",placeholder:"Chat Here...",className:"form-control chat-input"})})}),Object(o.jsx)("div",{className:"col-auto",children:Object(o.jsxs)("button",{type:"submit",className:"btn btn-primary btn-rounded chat-send w-md",children:[Object(o.jsx)("span",{className:"d-none d-sm-inline-block mr-2",children:"Send"}),Object(o.jsx)("svg",{width:13,height:13,viewBox:"0 0 24 24",tabIndex:-1,children:Object(o.jsx)("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z",fill:"white"})})]})})]})})};var J=e=>{const[s,t]=b(),n=Object(a.useRef)(null),c=s.rooms[s.currentRoom],r=null===c||void 0===c?void 0:c.id,o=null===c||void 0===c?void 0:c.messages,[l,i]=Object(a.useState)(""),d=Object(a.useCallback)((()=>{setTimeout((()=>{n.current&&(n.current.scrollTop=0)}),0)}),[]),m=Object(a.useCallback)((()=>{n.current&&n.current.scrollTo({top:n.current.scrollHeight})}),[]);Object(a.useEffect)((()=>{m()}),[o,m]);const u=Object(a.useCallback)((function(){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];v(r,arguments.length>0&&void 0!==arguments[0]?arguments[0]:0).then((async a=>{await N(s.users,t,a),t({type:e?"prepend messages":"set messages",payload:{id:r,messages:a}}),e?setTimeout((()=>{d()}),10):m()}))}),[t,r,m,d,s.users]);Object(a.useEffect)((()=>{void 0!==r&&void 0===o&&u()}),[o,t,r,s.users,s,m,u]),Object(a.useEffect)((()=>{n.current&&m()}),[m,r]);return{onLoadMoreMessages:Object(a.useCallback)((()=>{u(c.offset,!0)}),[u,c]),onUserClicked:async a=>{const n=s.users[a];let c=n.room;if(void 0===c){const s=await(async(e,s)=>O.a.post(f("/room"),{user1:e,user2:s}).then((e=>e.data)))(a,e.id);c=s.id,t({type:"set user",payload:{...n,room:c}}),t({type:"add room",payload:{id:c,name:y(s.names,e.username)}})}t({type:"set current room",payload:c})},message:l,setMessage:i,dispatch:t,room:c,rooms:s.rooms,currentRoom:s.currentRoom,messageListElement:n,roomId:r,users:s.users,messages:o}};function A(e){let{onLogOut:s,user:t,onMessageSend:a}=e;const{onLoadMoreMessages:n,onUserClicked:c,message:r,setMessage:l,rooms:i,room:d,currentRoom:m,dispatch:u,messageListElement:j,roomId:b,messages:h,users:g}=J(t);return Object(o.jsx)("div",{className:"container py-4 px-5",children:Object(o.jsxs)("div",{className:"chat-body row overflow-hidden shadow bg-light rounded",children:[Object(o.jsxs)("div",{className:"col-8 px-0 flex-column bg-white rounded-lg",children:[Object(o.jsx)("div",{className:"px-4 py-4",style:{borderBottom:"1px solid green"},children:Object(o.jsx)("h2",{className:"font-size-15 mb-0",children:d?d.name:"Chat Room"})}),Object(o.jsx)(P,{messageListElement:j,messages:h,room:d,onLoadMoreMessages:n,user:t,onUserClicked:c,users:g}),Object(o.jsx)(G,{message:r,setMessage:l,onSubmit:e=>{e.preventDefault(),a(r.trim(),b),l(""),j.current.scrollTop=j.current.scrollHeight}})]}),Object(o.jsx)("div",{className:"col-4 px-0",children:Object(o.jsx)(z,{user:t,onLogOut:s,rooms:i,currentRoom:m,dispatch:u})})]})})}function V(){return Object(o.jsx)("div",{className:"centered-box",children:Object(o.jsx)("div",{className:"spinner-border",role:"status",children:Object(o.jsx)("span",{className:"visually-hidden"})})})}var q=e=>{let{showLogin:s}=e;return Object(o.jsxs)("nav",{className:"navbar navbar-expand-lg navbar-light d-flex justify-content-between",children:[Object(o.jsx)("span",{className:"navbar-brand",children:"Chat Application"}),s?Object(o.jsx)("a",{href:"https://https://github.com/trungIsOnGithhub",children:"Github"}):Object(o.jsx)(o.Fragment,{})]})};const Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>{},s=arguments.length>1?arguments[1]:void 0;const[t,n]=Object(a.useState)(!0),[c,r]=Object(a.useState)(null);return Object(a.useEffect)((()=>{t&&O.a.get(f("/users/me")).then((e=>e.data)).catch((e=>null)).then((s=>{r(s),n(!1),e(s)}))}),[e,t]),{user:"string"===typeof c?null:c,onLogIn:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};t(null),a(!0),((e,s)=>O.a.post(f("/auth/login"),{username:e,password:s}).then((e=>e.data)).catch((e=>{throw new Error(e.response&&e.response.data&&e.response.data.message)})))(e,s).then((e=>{r(e),a(!1)})).catch((e=>{t(e.message),a(!1)}))},onLogOut:async()=>{O.a.post(f("/auth/logout")).then((()=>{r(null),s({type:"clear"}),n(!0)}))},loading:t}};t(77);const K=(e,s,t,a)=>{s.username!==e.username&&(t({type:"set user",payload:e}),void 0!==a&&t({type:"append message",payload:{id:"0",message:{date:1e4*Math.random(),from:"info",message:a}}}))},Q=(e,s,t)=>{const[n,c]=Object(a.useState)(!1),r=Object(a.useRef)(null),o=Object(a.useCallback)((async(s,t)=>(await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;return await O.a.post(f("/chat/emit"),{type:e,user:s,data:JSON.stringify(t)})}(s,e,t),{})),[e]),l=Object(a.useCallback)((async()=>{await o("user.disconnected",e),t()}),[t,o,e]);return Object(a.useEffect)((()=>{var t;null===e?(c(!1),null!==r.current&&(window.onbeforeunload=void 0,r.current.close(),r.current=null)):(null===r.current&&(r.current=(t=e.id,new EventSource(f("/chat/stream?userId=".concat(t)))),r.current.onmessage=function(t){const{type:a,data:n}=JSON.parse(t.data);switch(a){case"user.connected":K(n,e,s,"".concat(n.username," connected"));break;case"user.disconnected":K(n,e,s,"".concat(n.username," left"));break;case"show.room":((e,s,t)=>{t({type:"add room",payload:{id:e.id,name:y(e.names,s)}})})(n,e.username,s);break;case"message":((e,s)=>{s({type:"make user online",payload:e.from}),s({type:"append message",payload:{id:void 0===e.roomId?"0":e.roomId,message:e}})})(n,s)}},window.onbeforeunload=()=>{r.current&&r.current.close(),o("user.disconnected",e)},o("user.connected",e)),c(!0))}),[e,s,l,o]),[{emit:o},n,l]},X=()=>{const[e,s]=h(),t=Object(a.useCallback)((t=>{null!==t&&(e.users[t.id]||s({type:"set user",payload:{...t,online:!0}}))}),[s,e.users]),{user:n,onLogIn:c,onLogOut:r,loading:o}=Z(t,s),[l,i,d]=Q(n,s,r);Object(a.useEffect)((()=>{if(null!==n)if(i){const t=[];Object.keys(e.rooms).forEach((s=>{const a=e.rooms[s];a.connected||t.push({...a,connected:!0})})),0!==t.length&&s({type:"set rooms",payload:t})}else{const t=[];Object.keys(e.rooms).forEach((s=>{const a=e.rooms[s];a.connected&&t.push({...a,connected:!1})})),0!==t.length&&s({type:"set rooms",payload:t})}}),[n,i,s,l,e.rooms,e.users]),Object(a.useEffect)((()=>{0===Object.values(e.rooms).length&&null!==n&&(O.a.get(f("/users/online")).then((e=>e.data)).then((e=>{s({type:"append users",payload:e})})),(async e=>O.a.get(f("/rooms/user/".concat(e))).then((e=>e.data)))(n.id).then((e=>{const t=[];e.forEach((e=>{let{id:s,names:a}=e;t.push({id:s,name:y(a,n.username)})})),s({type:"set rooms",payload:t}),s({type:"set current room",payload:"0"})})))}),[s,e.rooms,n]);const m=Object(a.useCallback)(((e,s)=>{"string"===typeof e&&0!==e.trim().length&&(l||console.error("Couldn't send message"),l.emit("message",{roomId:s,message:e,from:n.id,date:p()(new Date).unix()}))}),[n,l]);return{loading:o,user:n,state:e,dispatch:s,onLogIn:c,onMessageSend:m,onLogOut:d}};var Y=()=>{const{loading:e,user:s,state:t,dispatch:a,onLogIn:n,onMessageSend:c,onLogOut:r}=X();if(e)return Object(o.jsx)(V,{});const l=!s;return Object(o.jsx)(j.Provider,{value:[t,a],children:Object(o.jsxs)("div",{className:"full-height ".concat(l?"bg-light":""),style:{backgroundColor:l?void 0:"#495057"},children:[Object(o.jsx)(q,{showLogin:l}),l?Object(o.jsx)(i,{onLogIn:n}):Object(o.jsx)(A,{user:s,onMessageSend:c,onLogOut:r})]})})};c.a.render(Object(o.jsx)(Y,{}),document.getElementById("root"))}},[[98,1,2]]]);
//# sourceMappingURL=main.1c245f20.chunk.js.map