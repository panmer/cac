{"version":3,"sources":["components/Login/index.jsx","state.js","api.js","utils.js","components/Chat/components/ChatList/components/ChatIcon.jsx","components/Chat/components/ChatList/components/AvatarImage.jsx","components/Chat/components/OnlineIndicator.jsx","components/Chat/components/ChatList/components/ChatListItem/index.jsx","components/Chat/components/ChatList/components/Footer.jsx","components/Chat/components/ChatList/index.jsx","components/Chat/components/MessageList/components/InfoMessage.jsx","components/Chat/components/MessageList/components/MessagesLoading.jsx","components/Chat/components/MessageList/components/NoMessages.jsx","components/Chat/components/MessageList/components/ClockIcon.jsx","components/Chat/components/MessageList/components/ReceiverMessage.jsx","components/Chat/components/MessageList/components/SenderMessage.jsx","components/Chat/components/MessageList/index.jsx","components/Chat/components/TypingArea.jsx","components/Chat/use-chat-handlers.js","components/Chat/index.jsx","components/LoadingScreen.jsx","components/Navbar.jsx","hooks.js","use-socket.js","App.jsx","index.jsx"],"names":["DEMO_USERS","Login","_ref","onLogIn","username","setUsername","useState","Math","floor","random","length","error","setError","password","setPassword","_jsx","_Fragment","children","className","_jsxs","style","boxShadow","maxWidth","backgroundColor","padding","src","concat","process","bottom","left","paddingTop","borderBottomLeftRadius","borderBottomRightRadius","onSubmit","async","event","preventDefault","UsernameSelect","names","htmlFor","value","onChange","target","type","id","required","height","Toast","minWidth","onClose","show","delay","autohide","Header","alt","Body","_ref2","_ref$current","open","setOpen","width","setWidth","ref","useRef","clientRectWidth","current","getBoundingClientRect","useEffect","listener","document","addEventListener","removeEventListener","_ref$current2","focus","tabIndex","onClick","o","d","fill","map","name","reducer","state","action","currentRoom","rooms","users","payload","online","messages","offset","undefined","lastMessage","message","newRooms","forEach","room","initialState","AppContext","createContext","useAppState","dispatch","useContext","useAppStateContext","useReducer","axios","defaults","withCredentials","getMessages","console","log","JSON","parse","window","sessionStorage","getItem","parseRoomName","populateUsersFromLoadedMessages","require","userIds","from","ids","Object","keys","filter","newUsers","stringify","element","isOnline","Error","getUsers","ChatIcon","viewBox","xmlns","rx","stroke","strokeWidth","x1","y1","x2","y2","gradientUnits","stopColor","AvatarImage","url","useMemo","av","roomId","arguments","uidParsed","split","pop","roomIdParsed","reverse","theId","getAvatarByUserAndRoomId","objectFit","OnlineIndicator","hide","opacity","useChatListItemHandlers","isUser","userId","pseudoUserId","abs","parseInt","usersFiltered","entries","user","_ref3","_","useLastMessage","ChatListItem","active","moment","unix","date","format","LogoutButton","onLogOut","col","noinfo","cursor","Plug","UserInfo","Footer","flex","minHeight","ChatList","processedRooms","roomsList","values","main","x","other","sort","a","b","InfoMessage","fontSize","MessagesLoading","role","NoMessages","CardText","size","ClockIcon","ReceiverMessage","borderRadius","fontWeight","SenderMessage","onUserClicked","color","MessageList","messageListElement","onLoadMoreMessages","key","TypingArea","setMessage","e","placeholder","useChatHandlers","scrollToTop","useCallback","setTimeout","scrollTop","scrollToBottom","scrollTo","top","scrollHeight","onFetchMessages","prepend","Chat","onMessageSend","borderBottom","trim","LoadingScreen","Navbar","showLogin","href","useUser","onUserLoaded","loading","setLoading","setUser","getMe","get","path","then","data","catch","onLoading","login","useAppHandlers","onLogOutA","socket","connected","useSocket","onLogOutBase","setConnected","emit","push","getRooms","Date","App","setItem","Provider","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.379660a1.chunk.js","sourcesContent":["// @ts-check\r\nimport { Toast } from \"react-bootstrap\";\r\nimport React, { useState, useRef } from \"react\";\r\nimport \"./style.css\";\r\nimport { useEffect } from \"react\";\r\n\r\nconst DEMO_USERS = [\"User1\", \"User2\", \"User3\", \"User4\"];\r\n\r\nexport default function Login({ onLogIn }) {\r\n  const [username, setUsername] = useState(\r\n    () => DEMO_USERS[Math.floor(Math.random() * DEMO_USERS.length)]\r\n  );\r\n\r\n  const [error, setError] = useState(null);\r\n  const [password, setPassword] = useState(\"password123\")\r\n\r\n  const onSubmit = async (event) => {\r\n    event.preventDefault();\r\n    onLogIn(username, password, setError);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"login-form text-center login-page\">\r\n        <div\r\n          className=\"rounded\"\r\n          style={{\r\n            boxShadow: \"0 0.75rem 1.5rem rgba(18,38,63,.03)\",\r\n          }}\r\n        >\r\n          <div className=\"position-relative\">\r\n            <div\r\n              className=\"row no-gutters align-items-center\"\r\n              style={{\r\n                maxWidth: 400,\r\n                backgroundColor: \"palegreen\",\r\n                padding: 20,\r\n              }}\r\n            >\r\n              <div className=\"col text-primary text-left\">\r\n                <h3 className=\"font-size-15\">Spring Redis Chat App!</h3>\r\n                <i>This is a UI demo of the application</i>\r\n              </div>\r\n              <div className=\"col align-self-end\">\r\n                <img\r\n                  style={{ maxWidth: \"80%\" }}\r\n                  src={`${process.env.PUBLIC_URL}/welcome-back.png`}\r\n                />\r\n              </div>\r\n            </div>\r\n            <div\r\n              className=\"position-absolute\"\r\n              style={{ bottom: -10, left: 20 }}\r\n            >\r\n            </div>\r\n          </div>\r\n\r\n          <form\r\n            className=\"bg-white text-left px-4\"\r\n            style={{\r\n              paddingTop: 20,\r\n              borderBottomLeftRadius: 4,\r\n              borderBottomRightRadius: 4,\r\n            }}\r\n            onSubmit={onSubmit}\r\n          >\r\n            <label className=\"font-size-12\">Name</label>\r\n\r\n            <div className=\"username-select mb-3\">\r\n              <UsernameSelect\r\n                username={username}\r\n                setUsername={setUsername}\r\n                names={DEMO_USERS}\r\n              />\r\n            </div>\r\n\r\n            <label htmlFor=\"inputPassword\" className=\"font-size-12\">\r\n              Password\r\n            </label>\r\n            <input\r\n              value={\"password123\"}\r\n              onChange={(event) => setPassword(event.target.value)}\r\n              type=\"password\"\r\n              id=\"inputPassword\"\r\n              className=\"form-control\"\r\n              required\r\n            />\r\n            <div style={{ height: 30 }} />\r\n            <button className=\"btn btn-lg btn-primary btn-block\" type=\"submit\">\r\n              Sign in\r\n            </button>\r\n            <div className=\"login-error-anchor\">\r\n              <div className=\"toast-box\">\r\n                <Toast\r\n                  style={{ minWidth: 277 }}\r\n                  onClose={() => setError(null)}\r\n                  show={error !== null}\r\n                  delay={3000}\r\n                  autohide\r\n                >\r\n                  <Toast.Header>\r\n                    <img\r\n                      src=\"holder.js/20x20?text=%20\"\r\n                      className=\"rounded mr-2\"\r\n                      alt=\"\"\r\n                    />\r\n                    <strong className=\"mr-auto\">Error</strong>\r\n                  </Toast.Header>\r\n                  <Toast.Body>{error}</Toast.Body>\r\n                </Toast>\r\n              </div>\r\n            </div>\r\n            <div style={{ height: 30 }} />\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nconst UsernameSelect = ({ username, setUsername, names = [\"\"] }) => {\r\n  const [open, setOpen] = useState(false);\r\n  const [width, setWidth] = useState(0);\r\n  const ref = useRef();\r\n  /** @ts-ignore */\r\n  const clientRectWidth = ref.current?.getBoundingClientRect().width;\r\n  useEffect(() => {\r\n    /** @ts-ignore */\r\n    setWidth(clientRectWidth);\r\n  }, [clientRectWidth]);\r\n\r\n  /** Click away listener */\r\n  useEffect(() => {\r\n    if (open) {\r\n      const listener = () => setOpen(false);\r\n      document.addEventListener(\"click\", listener);\r\n      return () => document.removeEventListener(\"click\", listener);\r\n    }\r\n  }, [open]);\r\n\r\n  /** Make the current div focused */\r\n  useEffect(() => {\r\n    if (open) {\r\n      /** @ts-ignore */\r\n      ref.current?.focus();\r\n    }\r\n  }, [open]);\r\n\r\n  return (\r\n    <div\r\n      tabIndex={0}\r\n      ref={ref}\r\n      className={`username-select-dropdown ${open ? \"open\" : \"\"}`}\r\n      onClick={() => setOpen((o) => !o)}\r\n    >\r\n      <div className=\"username-select-row\">\r\n        <div>{username}</div>\r\n        <div>\r\n          <svg width={24} height={24}>\r\n            <path d=\"M7 10l5 5 5-5z\" fill=\"#333\" />\r\n          </svg>\r\n        </div>\r\n      </div>\r\n      <div\r\n        style={{ width: width }}\r\n        className={`username-select-block ${open ? \"open\" : \"\"}`}\r\n      >\r\n        {names.map((name) => (\r\n          <div\r\n            className=\"username-select-block-item\"\r\n            key={name}\r\n            onClick={() => setUsername(name)}\r\n          >\r\n            {name}\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","// @ts-check\r\nimport { createContext, useContext, useReducer } from \"react\";\r\n\r\n/**\r\n * @typedef {{\r\n *  from: string\r\n *  date: number\r\n *  message: string\r\n *  roomId?: string\r\n * }} Message\r\n *\r\n * @typedef {{\r\n *   name: string;\r\n *   id: string;\r\n *   messages?: Message[]\r\n *   connected?: boolean;\r\n *   offset?: number;\r\n *   forUserId?: null | number | string\r\n *   lastMessage?: Message | null\r\n * }} Room\r\n *\r\n * @typedef {{\r\n *   username: string;\r\n *   id: string;\r\n *   online?: boolean;\r\n *   room?: string;\r\n * }} UserEntry\r\n *\r\n * @typedef {{\r\n *  currentRoom: string;\r\n *  rooms: {[id: string]: Room};\r\n *  users: {[id: string]: UserEntry}\r\n * }} State\r\n *\r\n * @param {State} state\r\n * @param {{type: string; payload: any}} action\r\n * @returns {State}\r\n */\r\nconst reducer = (state, action) => {\r\n  switch (action.type) {\r\n    case \"clear\":\r\n      return { currentRoom: \"0\", rooms: {}, users: {} };\r\n    case \"set user\": {\r\n      return {\r\n        ...state,\r\n        users: { ...state.users, [action.payload.id]: action.payload },\r\n      };\r\n    }\r\n    case \"make user online\": {\r\n      return {\r\n        ...state,\r\n        users: {\r\n          ...state.users,\r\n          [action.payload]: { ...state.users[action.payload], online: true },\r\n        },\r\n      };\r\n    }\r\n    case \"append users\": {\r\n      return { ...state, users: { ...state.users, ...action.payload } };\r\n    }\r\n    case \"set messages\": {\r\n      return {\r\n        ...state,\r\n        rooms: {\r\n          ...state.rooms,\r\n          [action.payload.id]: {\r\n            ...state.rooms[action.payload.id],\r\n            messages: action.payload.messages,\r\n            offset: action.payload.messages.length,\r\n          },\r\n        },\r\n      };\r\n    }\r\n    case \"prepend messages\": {\r\n      const messages = [\r\n        ...action.payload.messages,\r\n        ...state.rooms[action.payload.id].messages,\r\n      ];\r\n      return {\r\n        ...state,\r\n        rooms: {\r\n          ...state.rooms,\r\n          [action.payload.id]: {\r\n            ...state.rooms[action.payload.id],\r\n            messages,\r\n            offset: messages.length,\r\n          },\r\n        },\r\n      };\r\n    }\r\n    case \"append message\":\r\n      if (state.rooms[action.payload.id] === undefined) {\r\n        return state;\r\n      }\r\n      return {\r\n        ...state,\r\n        rooms: {\r\n          ...state.rooms,\r\n          [action.payload.id]: {\r\n            ...state.rooms[action.payload.id],\r\n            lastMessage: action.payload.message,\r\n            messages: state.rooms[action.payload.id].messages\r\n              ? [\r\n                ...state.rooms[action.payload.id].messages,\r\n                action.payload.message,\r\n              ]\r\n              : undefined,\r\n          },\r\n        },\r\n      };\r\n    case 'set last message':\r\n      return { ...state, rooms: { ...state.rooms, [action.payload.id]: { ...state.rooms[action.payload.id], lastMessage: action.payload.lastMessage } } };\r\n    case \"set current room\":\r\n      return { ...state, currentRoom: action.payload };\r\n    case \"add room\":\r\n      return {\r\n        ...state,\r\n        rooms: { ...state.rooms, [action.payload.id]: action.payload },\r\n      };\r\n    case \"set rooms\": {\r\n      /** @type {Room[]} */\r\n      const newRooms = action.payload;\r\n      const rooms = { ...state.rooms };\r\n      newRooms.forEach((room) => {\r\n        rooms[room.id] = {\r\n          ...room,\r\n          messages: rooms[room.id] && rooms[room.id].messages,\r\n        };\r\n      });\r\n      return { ...state, rooms };\r\n    }\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\n/** @type {State} */\r\nconst initialState = {\r\n  currentRoom: \"main\",\r\n  rooms: {},\r\n  users: {},\r\n};\r\n\r\nconst useAppStateContext = () => {\r\n  return useReducer(reducer, initialState);\r\n};\r\n\r\n// @ts-ignore\r\nexport const AppContext = createContext();\r\n\r\n/**\r\n * @returns {[\r\n *  State,\r\n *  React.Dispatch<{\r\n *   type: string;\r\n *   payload: any;\r\n * }>\r\n * ]}\r\n */\r\nexport const useAppState = () => {\r\n  const [state, dispatch] = useContext(AppContext);\r\n  return [state, dispatch];\r\n};\r\n\r\nexport default useAppStateContext;","import axios from 'axios';\r\naxios.defaults.withCredentials = true;\r\n\r\nconst BASE_URL = 'http://localhost:8080';\r\n\r\nexport const MESSAGES_TO_LOAD = 10;\r\n\r\nfunction url(path) { return `${BASE_URL}${path}`; }\r\n\r\n/** Checks if there's an existing session. */\r\nexport const getMe = () => {\r\n  return axios.get(url('/users/me'))\r\n    .then(x => {\r\n      console.log(JSON.stringify(\"Me : \" + x.data));\r\n      return x.data;\r\n    })\r\n    .catch(_ => null);\r\n};\r\n\r\n/** \r\n * Fetch users by requested ids\r\n * @param {Array<number | string>} ids\r\n */\r\nexport const getUsers = (ids) => {\r\n  console.log(JSON.stringify(ids));\r\n  return ids.map(element => {\r\n    switch(element) {\r\n      case \"1\":\r\n        return { id: 1, username: \"User1\", isOnline: false };\r\n      case \"2\":\r\n        return { id: 2, username: \"User2\", isOnline: false };\r\n      case \"3\":\r\n        return { id: 3, username: \"User3\", isOnline: false };\r\n      case \"4\":\r\n        return { id: 4, username: \"User4\", isOnline: false };\r\n      default:\r\n        throw new Error(\"Wrong Username\");\r\n    } \r\n  })\r\n  // return axios.get(url(`/users`), { params: { ids: ids.reduce((x, y) => `${x},${y}`) } }).then(x => { console.log(\"=======> \" + JSON.stringify(x.data)); return x.data; });\r\n  // return ids.filter()\r\n};\r\n\r\n/** Fetch users which are online */\r\nexport const getOnlineUsers = () => {\r\n  return {};\r\n  // return axios.get(url(`/users/online`)).then(x => { console.log(\"Online users: \" + JSON.stringify(x.data)); return x.data; });\r\n};\r\n\r\n/** Handle user log in */\r\nexport const login = (username, password) => {\r\n  if (password !== \"password123\") {\r\n    throw new Error(\"Wrong Password\");\r\n  }\r\n\r\n  switch(username) {\r\n    case \"User1\":\r\n      return { id: 1, username: \"User1\", isOnline: true };\r\n    case \"User2\":\r\n      return { id: 2, username: \"User2\", isOnline: true };\r\n    case \"User3\":\r\n      return { id: 3, username: \"User3\", isOnline: true };\r\n    case \"User4\":\r\n      return { id: 4, username: \"User4\", isOnline: true };\r\n    default:\r\n      throw new Error(\"Wrong Username\");\r\n  }\r\n  // return axios.post(url('/auth/login'), {\r\n  //   username,\r\n  //   password\r\n  // }).then(x =>\r\n  //   { console.log(x.data); return x.data; }\r\n  // )\r\n  //   .catch(e => { throw new Error(e.response && e.response.data && e.response.data.message); });\r\n};\r\n\r\nexport const logOut = () => {\r\n  // return axios.post(url('/auth/logout'));\r\n};\r\n\r\n// /** \r\n//  * Function for checking which deployment urls exist.\r\n//  * \r\n//  * @returns {Promise<{\r\n//  *   heroku?: string;\r\n//  *   google_cloud?: string;\r\n//  *   vercel?: string;\r\n//  *   github?: string;\r\n//  * }>} \r\n//  */\r\n// export const getButtonLinks = () => {\r\n//   return axios.get(url('/links'))\r\n//     .then(x => x.data)\r\n//     .catch(_ => null);\r\n// };\r\n// \r\n// [{id:\"1:2\",names:[\"User1\",\"User2\"]},{id:\"1:3\",names:[\"User1\",\"User3\"]},{id:\"1:4\",names:[\"User1\",\"User4\"]},{id:\"0\",names:[\"General\"]}]\r\n// \r\n// \r\n\r\n/** \r\n * @returns {Promise<Array<{ names: string[]; id: string }>>} \r\n */\r\nexport const getRooms = (userId) => {\r\n  console.log(typeof userId);\r\n  switch(userId) {\r\n    case 2:\r\n      return [{id:\"2:3\",names:[\"User2\",\"User3\"]},{id:\"1:2\",names:[\"User1\",\"User2\"]},{id:\"2:4\",names:[\"User2\",\"User4\"]},{id:\"0\",names:[\"General\"]}];\r\n    case 1:\r\n      return [{id:\"1:2\",names:[\"User1\",\"User2\"]},{id:\"1:3\",names:[\"User1\",\"User3\"]},{id:\"1:4\",names:[\"User1\",\"User4\"]},{id:\"0\",names:[\"General\"]}];\r\n    case 3:\r\n      return [{id:\"3:4\",names:[\"User3\",\"User4\"]},{id:\"2:4\",names:[\"User2\",\"User4\"]},{id:\"1:4\",names:[\"User1\",\"User4\"]},{id:\"0\",names:[\"General\"]}];\r\n    case 4:\r\n      return { id: 4, username: \"User4\", isOnline: true };\r\n    default:\r\n      throw new Error(\"Wrong UserID\");\r\n  }\r\n  // return axios.get(url(`/rooms/user/${userId}`)).then(x => { console.log(JSON.stringify(x.data)); return x.data; });\r\n};\r\n\r\n// getRooms(4);\r\n\r\nexport const getMessages = (id,\r\n  offset = 0,\r\n  size = MESSAGES_TO_LOAD\r\n) => {\r\n  // console.log(\"+++\" + typeof id)\r\n  console.log(\"|||\"+id+\"|||\");\r\n  // [{\"from\":\"1\",\"date\":1700127951,\"message\":\"isld a dsjadlkjsada dlisajdl\",\"roomId\":\"0\"},{\"from\":\"1\",\"date\":1700127958,\"message\":\"jslks;dsada\",\"roomId\":\"0\"}] api.js:130\r\n\r\n  let allMessages = JSON.parse(window.sessionStorage.getItem(\"allMessages\"));\r\n  return allMessages[id];\r\n  // throw new Error(\"Wrong RoomID\");\r\n  // return axios.get(url(`/rooms/messages/${id}`), {\r\n  //   params: {\r\n  //     offset,\r\n  //     size\r\n  //   }\r\n  // })\r\n  //   .then(x => { console.log(JSON.stringify(x.data.reverse())); return x.data; });\r\n};\r\n\r\n/** This one is called on a private messages room created. */\r\n// export const addRoom = async (user1, user2) => {\r\n//   return axios.post(url(`/room`), { user1, user2 }).then(x => { console.log(\"Add room: \" + x.data); return x.data; });\r\n// };\r\n\r\nexport const emitMessage = (type = \"\", user, message) => {\r\n  console.log(\"from api.js &&&&& \"+JSON.stringify(user));\r\n  let allMessages = JSON.parse(window.sessionStorage.getItem(\"allMessages\"));\r\n  allMessages[message.roomId].push(message);\r\n  window.sessionStorage.setItem(\"allMessages\", JSON.stringify(allMessages));\r\n  console.log(allMessages[message.roomId]);\r\n};\r\n\r\n// export const getEventSource = (userId) => new EventSource(url(`/chat/stream?userId=${userId}`));\r\n","// @ts-check\r\n\r\nimport { getUsers } from \"./api\";\r\n\r\n/**\r\n * @param {string[]} names\r\n * @param {string} username\r\n */\r\nexport const parseRoomName = (names, username) => {\r\n  for (let name of names) {\r\n    if (typeof name !== 'string') {\r\n      name = name[0];\r\n    }\r\n    if (name !== username) {\r\n      return name;\r\n    }\r\n  }\r\n  return names[0];\r\n};\r\n\r\n/** Get an avatar for a room or a user */\r\nexport const getAvatarByUserAndRoomId = (roomId = \"1\") => {\r\n  const TOTAL_IMAGES = 13;\r\n  const seed1 = 654;\r\n  const seed2 = 531;\r\n\r\n  const uidParsed = +roomId.split(\":\").pop();\r\n  let roomIdParsed = +roomId.split(\":\").reverse().pop();\r\n  if (roomIdParsed < 0) {\r\n    roomIdParsed += 3555;\r\n  }\r\n\r\n  const theId = (uidParsed * seed1 + roomIdParsed * seed2) % TOTAL_IMAGES;\r\n\r\n  // @ts-ignore\r\n  return `${process.env.PUBLIC_URL}/avatars/${theId}.jpg`;\r\n};\r\n\r\nconst jdenticon = require(\"jdenticon\");\r\n\r\nconst avatars = {};\r\nexport const getAvatar = (username) => {\r\n  let av = avatars[username];\r\n  if (av === undefined) {\r\n    av =\r\n      \"data:image/svg+xml;base64,\" + window.btoa(jdenticon.toSvg(username, 50));\r\n    avatars[username] = av;\r\n  }\r\n  return av;\r\n};\r\n\r\nexport const populateUsersFromLoadedMessages = async (users, dispatch, messages) => {\r\n  const userIds = {};\r\n  messages.forEach((message) => {\r\n    userIds[message.from] = 1;\r\n  });\r\n\r\n  console.log(\"*************************8888888\");\r\n\r\n  const ids = Object.keys(userIds).filter(\r\n    (id) => users[id] === undefined\r\n  );\r\n\r\n  if (ids.length !== 0) {\r\n    const newUsers = await getUsers(ids);\r\n    dispatch({\r\n      type: \"append users\",\r\n      payload: newUsers,\r\n    });\r\n  }\r\n\r\n};","const ChatIcon = () => (\r\n  <svg\r\n    width=\"32\"\r\n    height=\"32\"\r\n    viewBox=\"0 0 1651 1651\"\r\n    fill=\"none\"\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n  >\r\n    <rect width=\"1651\" height=\"1651\" rx=\"14\" fill=\"white\" />\r\n    <path\r\n      d=\"M495.286 1098.96L497.967 1070.86L478.04 1050.88C408.572 981.233 368 891.771 368 795.344C368 585.371 565.306 402 826 402C1086.69 402 1284 585.371 1284 795.344C1284 1005.32 1086.69 1188.69 826 1188.69V1248.69L825.913 1188.69C779.837 1188.75 733.952 1182.77 689.432 1170.9L667.26 1164.98L646.8 1175.37C620.731 1188.61 562.74 1213.98 467.32 1235.35C480.554 1191.83 490.95 1144.39 495.286 1098.96Z\"\r\n      stroke=\"url(#paint0_linear)\"\r\n      strokeWidth=\"120\"\r\n    />\r\n    <defs>\r\n      <linearGradient\r\n        id=\"paint0_linear\"\r\n        x1=\"662.312\"\r\n        y1=\"397.956\"\r\n        x2=\"416.164\"\r\n        y2=\"1678.7\"\r\n        gradientUnits=\"userSpaceOnUse\"\r\n      >\r\n        <stop stopColor=\"#7514FB\" />\r\n        <stop offset=\"0.624243\" stopColor=\"#F26D41\" />\r\n        <stop offset=\"1\" stopColor=\"#F43B4B\" />\r\n      </linearGradient>\r\n    </defs>\r\n  </svg>\r\n);\r\n\r\nexport default ChatIcon;\r\n","// @ts-check\r\nimport React, { useMemo } from \"react\";\r\nimport { getAvatarByUserAndRoomId } from \"../../../../../utils\";\r\nimport ChatIcon from \"./ChatIcon\";\r\n\r\nconst AvatarImage = ({ name, id }) => {\r\n  const url = useMemo(() => {\r\n    const av = getAvatarByUserAndRoomId(\"\" + id);\r\n    if (name === \"User1\") {\r\n      return `${process.env.PUBLIC_URL}/avatars/0.jpg`;\r\n    } else if (name === \"User2\") {\r\n      return `${process.env.PUBLIC_URL}/avatars/2.jpg`;\r\n    } else if (name === \"User3\") {\r\n      return `${process.env.PUBLIC_URL}/avatars/9.jpg`;\r\n    } else if (name === \"User4\") {\r\n      return `${process.env.PUBLIC_URL}/avatars/8.jpg`;\r\n    }\r\n    return av;\r\n  }, [id, name]);\r\n\r\n  return (\r\n    <>\r\n      {name !== \"General\" ? (\r\n        <img\r\n          src={url}\r\n          alt={name}\r\n          style={{ width: 32, height: 32, objectFit: \"cover\" }}\r\n          className=\"rounded-circle avatar-xs\"\r\n        />\r\n      ) : (\r\n        <div className=\"overflow-hidden rounded-circle\">\r\n          <ChatIcon />\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AvatarImage;\r\n","const OnlineIndicator = ({ online, hide = false, width = 8, height = 8 }) => {\r\n  return (\r\n    <div\r\n      className={\r\n        online ? \"rounded-circle bg-success\" : \"rounded-circle bg-gray\"\r\n      }\r\n      style={{ width, height, opacity: hide ? 0 : 1 }}\r\n    ></div>\r\n  );\r\n};\r\n\r\nexport default OnlineIndicator;\r\n","// @ts-check\r\nimport \"./style.css\";\r\nimport React, { useMemo } from \"react\";\r\nimport { useAppState } from \"../../../../../../state\";\r\nimport moment from \"moment\";\r\nimport { useEffect } from \"react\";\r\nimport { getMessages } from \"../../../../../../api\";\r\nimport AvatarImage from \"../AvatarImage\";\r\nimport OnlineIndicator from \"../../../OnlineIndicator\";\r\n\r\n/**\r\n * @param {{ active: boolean; room: import('../../../../../../state').Room; onClick: () => void; }} props\r\n */\r\nconst ChatListItem = ({ room, active = false, onClick }) => {\r\n  const { online, name, lastMessage, userId } = useChatListItemHandlers(room);\r\n  return (\r\n    <div\r\n      onClick={onClick}\r\n      className={`chat-list-item d-flex align-items-start rounded ${\r\n        active ? \"bg-white\" : \"\"\r\n      }`}\r\n    >\r\n      <div className=\"align-self-center mr-3\">\r\n        <OnlineIndicator online={online} hide={room.id === \"0\"} />\r\n      </div>\r\n      <div className=\"align-self-center mr-3\">\r\n        <AvatarImage name={name} id={userId} />\r\n      </div>\r\n      <div className=\"media-body overflow-hidden\">\r\n        <h5 className=\"text-truncate font-size-14 mb-1\">{name}</h5>\r\n        {lastMessage && (\r\n          <p className=\"text-truncate mb-0\"> {lastMessage.message} </p>\r\n        )}\r\n      </div>\r\n      {lastMessage && (\r\n        <div className=\"font-size-11\">\r\n          {moment.unix(lastMessage.date).format(\"LT\")}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst useChatListItemHandlers = (\r\n  /** @type {import(\"../../../../../../state\").Room} */ room\r\n) => {\r\n  const { id, name } = room;\r\n  const [state] = useAppState();\r\n\r\n  /** Here we want to associate the room with a user by its name (since it's unique). */\r\n  const [isUser, online, userId] = useMemo(() => {\r\n    try {\r\n      let pseudoUserId = Math.abs(parseInt(id.split(\":\").reverse().pop()));\r\n      const isUser = pseudoUserId > 0;\r\n      const usersFiltered = Object.entries(state.users)\r\n        .filter(([, user]) => user.username === name)\r\n        .map(([, user]) => user);\r\n      let online = false;\r\n      if (usersFiltered.length > 0) {\r\n        online = usersFiltered[0].online;\r\n        pseudoUserId = +usersFiltered[0].id;\r\n      }\r\n      return [isUser, online, pseudoUserId];\r\n    } catch (_) {\r\n      return [false, false, \"0\"];\r\n    }\r\n  }, [id, name, state.users]);\r\n\r\n  const lastMessage = useLastMessage(room);\r\n\r\n  return {\r\n    isUser,\r\n    online,\r\n    userId,\r\n    name: room.name,\r\n    lastMessage,\r\n  };\r\n};\r\n\r\nconst useLastMessage = (\r\n  /** @type {import(\"../../../../../../state\").Room} */ room\r\n) => {\r\n  const [, dispatch] = useAppState();\r\n  const { lastMessage } = room;\r\n  useEffect(() => {\r\n    if (lastMessage === undefined) {\r\n      /** need to fetch it */\r\n      if (room.messages === undefined) {\r\n        let messages = getMessages(room.id, 0, 1)\r\n        //.then((messages) => {\r\n          let message = null;\r\n          if (messages.length !== 0) {\r\n            message = messages.pop();\r\n          }\r\n          dispatch({\r\n            type: \"set last message\",\r\n            payload: { id: room.id, lastMessage: message },\r\n          });\r\n        //});\r\n      } else if (room.messages.length === 0) {\r\n        dispatch({\r\n          type: \"set last message\",\r\n          payload: { id: room.id, lastMessage: null },\r\n        });\r\n      } else {\r\n        dispatch({\r\n          type: \"set last message\",\r\n          payload: {\r\n            id: room.id,\r\n            lastMessage: room.messages[room.messages.length - 1],\r\n          },\r\n        });\r\n      }\r\n    }\r\n  }, [lastMessage, dispatch, room]);\r\n\r\n  return lastMessage;\r\n};\r\n\r\nexport default ChatListItem;\r\n","// @ts-check\r\n\r\nimport React from \"react\";\r\nimport { Plug } from \"react-bootstrap-icons\";\r\nimport OnlineIndicator from \"../../OnlineIndicator\";\r\nimport AvatarImage from \"./AvatarImage\";\r\n\r\nconst Footer = ({ user, onLogOut }) => (\r\n  <div\r\n    className=\"row no-gutters align-items-center pl-4 pr-2 pb-3\"\r\n    style={{ height: \"inherit\", flex: 0, minHeight: 50 }}\r\n  >\r\n    {true ? (\r\n      <>\r\n        <UserInfo user={user} col={8} />\r\n        <LogoutButton onLogOut={onLogOut} col={4} />\r\n      </>\r\n    ) : (\r\n      <>\r\n        <LogoutButton noinfo onLogOut={onLogOut} col={8} />\r\n        <UserInfo noinfo user={user} col={4} />\r\n      </>\r\n    )}\r\n  </div>\r\n);\r\n\r\nconst LogoutButton = ({ onLogOut, col = 5, noinfo = false }) => (\r\n  <div\r\n    onClick={onLogOut}\r\n    style={{ cursor: \"pointer\" }}\r\n    className={`col-${col} text-danger ${!noinfo ? \"text-right\" : \"\"}`}\r\n  >\r\n    <Plug/> Exit Chat\r\n  </div>\r\n);\r\n\r\nconst UserInfo = ({ user, col = 7, noinfo = false }) => (\r\n  <div\r\n    className={`col-${col} d-flex align-items-center ${\r\n      noinfo ? \"justify-content-end\" : \"\"\r\n    }`}\r\n  >\r\n    <div className={`align-self-center ${noinfo ? \"\" : \"mr-3\"}`}>\r\n      <AvatarImage name={user.username} id={user.id} />\r\n    </div>\r\n    {!noinfo && (\r\n      <div className=\"media-body\">\r\n        <h5 className=\"font-size-14 mt-0 mb-1\">{user.username}</h5>\r\n        <div className=\"d-flex align-items-center\">\r\n          <OnlineIndicator online={true} />\r\n          <p className=\"ml-2 text-muted mb-0\">Active</p>\r\n        </div>\r\n      </div>\r\n    )}\r\n  </div>\r\n);\r\n\r\nexport default Footer;\r\n","// @ts-check\r\nimport React, { useMemo } from \"react\";\r\nimport ChatListItem from \"./components/ChatListItem\";\r\nimport Footer from \"./components/Footer\";\r\n\r\nconst ChatList = ({ rooms, dispatch, user, currentRoom, onLogOut }) => {\r\n  const processedRooms = useMemo(() => {\r\n    const roomsList = Object.values(rooms);\r\n    const main = roomsList.filter((x) => x.id === \"0\");\r\n    let other = roomsList.filter((x) => x.id !== \"0\");\r\n    other = other.sort(\r\n      (a, b) => +a.id.split(\":\").pop() - +b.id.split(\":\").pop()\r\n    );\r\n    return [...(main ? main : []), ...other];\r\n  }, [rooms]);\r\n  return (\r\n    <>\r\n      <div className=\"chat-list-container flex-column d-flex pr-4\">\r\n        <div className=\"messages-box flex flex-1\">\r\n          <div className=\"list-group rounded-0\">\r\n            {processedRooms.map((room) => (\r\n              <ChatListItem\r\n                key={room.id}\r\n                onClick={() =>\r\n                  dispatch({ type: \"set current room\", payload: room.id })\r\n                }\r\n                active={currentRoom === room.id}\r\n                room={room}\r\n              />\r\n            ))}\r\n          </div>\r\n        </div>\r\n        <div className=\"py-2\">\r\n          <p className=\"h5 mb-0 py-1 chats-title\">Chats</p>\r\n        </div>\r\n        <Footer user={user} onLogOut={onLogOut} />\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ChatList;\r\n","// @ts-check\r\nconst InfoMessage = ({ message }) => {\r\n  return (\r\n    <p\r\n      className=\"mb-2 fs-6 fw-light fst-italic text-black-50 text-center\"\r\n      style={{ opacity: 0.8, fontSize: 14 }}\r\n    >\r\n      {message}\r\n    </p>\r\n  );\r\n};\r\n\r\nexport default InfoMessage;\r\n","// @ts-check\r\nimport React from \"react\";\r\n\r\nconst MessagesLoading = () => {\r\n  return (\r\n    <div className=\"no-messages flex-column d-flex flex-row justify-content-center align-items-center text-muted text-center\">\r\n      <div className=\"spinner-border\" role=\"status\">\r\n        <span className=\"visually-hidden\" />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MessagesLoading;\r\n","// @ts-check\r\nimport React from \"react\";\r\nimport { CardText } from \"react-bootstrap-icons\";\r\n\r\nconst NoMessages = () => {\r\n  return (\r\n    <div className=\"no-messages flex-column d-flex flex-row justify-content-center align-items-center text-muted text-center\">\r\n      <CardText size={96} />\r\n      <p>No messages</p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NoMessages;\r\n","const ClockIcon = () => (\r\n  <svg\r\n    width={12}\r\n    height={12}\r\n    className=\"prefix__MuiSvgIcon-root prefix__jss80 prefix__MuiSvgIcon-fontSizeLarge\"\r\n    viewBox=\"0 0 24 24\"\r\n    aria-hidden=\"true\"\r\n  >\r\n    <path d=\"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z\" />\r\n    <path d=\"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z\" />\r\n  </svg>\r\n);\r\n\r\nexport default ClockIcon;\r\n","// @ts-check\r\nimport moment from \"moment\";\r\nimport React from \"react\";\r\nimport ClockIcon from \"./ClockIcon\";\r\n\r\nconst ReceiverMessage = ({\r\n  username = \"user\",\r\n  message = \"Lorem ipsum dolor...\",\r\n  date,\r\n}) => (\r\n  <div className=\"d-flex\">\r\n    <div style={{ flex: 1 }} />\r\n    <div style={{ width: \"50%\" }} className=\"text-right mb-4\">\r\n      <div\r\n        className=\"conversation-list d-inline-block bg-light px-3 py-2\"\r\n        style={{ borderRadius: 12 }}\r\n      >\r\n        <div className=\"ctext-wrap\">\r\n          <div\r\n            className=\"conversation-name text-left text-primary mb-1\"\r\n            style={{\r\n              fontWeight: 600,\r\n            }}\r\n          >\r\n            {username}\r\n          </div>\r\n          <p className=\"text-left\">{message}</p>\r\n          <p className=\"chat-time mb-0\">\r\n            <ClockIcon /> {moment.unix(date).format(\"LT\")}{\" \"}\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\nexport default ReceiverMessage;\r\n","// @ts-check\r\nimport moment from \"moment\";\r\nimport React from \"react\";\r\nimport ClockIcon from \"./ClockIcon\";\r\nimport OnlineIndicator from \"../../OnlineIndicator\";\r\n\r\nconst SenderMessage = ({\r\n  user,\r\n  message = \"Lorem ipsum dolor...\",\r\n  date,\r\n  onUserClicked,\r\n}) => (\r\n  <div className=\"d-flex\">\r\n    <div style={{ width: \"50%\" }} className=\"text-left mb-4\">\r\n      <div\r\n        className=\"conversation-list d-inline-block px-3 py-2\"\r\n        style={{ borderRadius: 12, backgroundColor: \"rgba(85, 110, 230, 0.1)\" }}\r\n      >\r\n        <div className=\"ctext-wrap\">\r\n          {user && (\r\n            <div className=\"conversation-name d-flex align-items-center mb-1\">\r\n              <div\r\n                className=\"mr-2\"\r\n                style={{\r\n                  fontWeight: 600,\r\n                  cursor: \"pointer\",\r\n                  color: \"green\"\r\n                }}\r\n                onClick={onUserClicked}\r\n              >\r\n                {user.username}\r\n              </div>\r\n              <OnlineIndicator width={7} height={7} online={user.online} />\r\n            </div>\r\n          )}\r\n          <p className=\"text-left\">{message}</p>\r\n          <p className=\"chat-time mb-0\">\r\n            <ClockIcon /> {moment.unix(date).format(\"LT\")}{\" \"}\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div style={{ flex: 1 }} />\r\n  </div>\r\n);\r\n\r\nexport default SenderMessage;\r\n","// @ts-check\r\nimport React from \"react\";\r\nimport { MESSAGES_TO_LOAD } from \"../../../../api\";\r\nimport InfoMessage from \"./components/InfoMessage\";\r\nimport MessagesLoading from \"./components/MessagesLoading\";\r\nimport NoMessages from \"./components/NoMessages\";\r\nimport ReceiverMessage from \"./components/ReceiverMessage\";\r\nimport SenderMessage from \"./components/SenderMessage\";\r\n\r\nconst MessageList = ({\r\n  messageListElement,\r\n  messages,\r\n  room,\r\n  onLoadMoreMessages,\r\n  user,\r\n  onUserClicked,\r\n  users,\r\n}) => (\r\n  <div\r\n    ref={messageListElement}\r\n    className=\"chat-box-wrapper position-relative d-flex\"\r\n  >\r\n    {messages === undefined ? (\r\n      <MessagesLoading />\r\n    ) : messages.length === 0 ? (\r\n      <NoMessages />\r\n    ) : (\r\n      <></>\r\n    )}\r\n    <div className=\"px-4 pt-5 chat-box position-absolute\">\r\n      {messages && messages.length !== 0 && (\r\n        <>\r\n          {room.offset && room.offset >= MESSAGES_TO_LOAD ? (\r\n            <div className=\"d-flex flex-row align-items-center mb-4\">\r\n              <div\r\n                style={{ height: 1, backgroundColor: \"#eee\", flex: 1 }}\r\n              ></div>\r\n              <div className=\"mx-3\">\r\n                <button\r\n                  aria-haspopup=\"true\"\r\n                  aria-expanded=\"true\"\r\n                  type=\"button\"\r\n                  onClick={onLoadMoreMessages}\r\n                  className=\"btn rounded-button btn-secondary nav-btn\"\r\n                  id=\"__BVID__168__BV_toggle_\"\r\n                >\r\n                  Load more\r\n                </button>\r\n              </div>\r\n              <div\r\n                style={{ height: 1, backgroundColor: \"#eee\", flex: 1 }}\r\n              ></div>\r\n            </div>\r\n          ) : (\r\n            <></>\r\n          )}\r\n          {messages.map((message, x) => {\r\n            const key = message.message + message.date + message.from + x;\r\n            if (message.from === \"info\") {\r\n              return <InfoMessage key={key} message={message.message} />;\r\n            }\r\n            if (+message.from !== +user.id) {\r\n              return (\r\n                <SenderMessage\r\n                  onUserClicked={() => onUserClicked(message.from)}\r\n                  key={key}\r\n                  message={message.message}\r\n                  date={message.date}\r\n                  user={users[message.from]}\r\n                />\r\n              );\r\n            }\r\n            return (\r\n              <ReceiverMessage\r\n                username={\r\n                  users[message.from] ? users[message.from].username : \"\"\r\n                }\r\n                key={key}\r\n                message={message.message}\r\n                date={message.date}\r\n              />\r\n            );\r\n          })}\r\n        </>\r\n      )}\r\n    </div>\r\n  </div>\r\n);\r\nexport default MessageList;\r\n","// @ts-check\r\nconst TypingArea = ({ message, setMessage, onSubmit }) => (\r\n  <div className=\"p-3 chat-input-section\">\r\n    <form className=\"row\" onSubmit={onSubmit}>\r\n      <div className=\"col\">\r\n        <div className=\"position-relative\">\r\n          <input\r\n            value={message}\r\n            onChange={(e) => setMessage(e.target.value)}\r\n            type=\"text\"\r\n            placeholder=\"Chat Here...\"\r\n            className=\"form-control chat-input\"\r\n          />\r\n          {/**/}\r\n        </div>\r\n      </div>\r\n      <div className=\"col-auto\">\r\n        <button\r\n          type=\"submit\"\r\n          className=\"btn btn-primary btn-rounded chat-send w-md\"\r\n        >\r\n          <span className=\"d-none d-sm-inline-block mr-2\">Send</span>\r\n          <svg width={13} height={13} viewBox=\"0 0 24 24\" tabIndex={-1}>\r\n            <path d=\"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z\" fill=\"white\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n    </form>\r\n  </div>\r\n);\r\n\r\nexport default TypingArea;\r\n","// @ts-check\r\nimport { useCallback } from \"react\";\r\nimport { useEffect, useState, useRef } from \"react\";\r\nimport { addRoom, getMessages } from \"../../api\";\r\nimport { useAppState } from \"../../state\";\r\nimport { parseRoomName, populateUsersFromLoadedMessages } from \"../../utils\";\r\n\r\n/** Lifecycle hooks with callbacks for the Chat component */\r\nconst useChatHandlers = (/** @type {import(\"../../state\").UserEntry} */ user) => {\r\n  console.log(\"*************************66666666666666\");\r\n  const [state, dispatch] = useAppState();\r\n  const messageListElement = useRef(null);\r\n\r\n  /** @type {import(\"../../state\").Room} */\r\n  const room = state.rooms[state.currentRoom];\r\n\r\n  // console.log(\"&&&&&&&&&&&&&&&&&& \" + JSON.stringify(state.rooms));\r\n\r\n  const roomId = room?.id;\r\n  const messages = room?.messages;\r\n\r\n  const [message, setMessage] = useState(\"\");\r\n\r\n  const scrollToTop = useCallback(() => {\r\n    setTimeout(() => {\r\n      if (messageListElement.current) {\r\n        messageListElement.current.scrollTop = 0;\r\n      }\r\n    }, 0);\r\n  }, []);\r\n\r\n  const scrollToBottom = useCallback(() => {\r\n    if (messageListElement.current) {\r\n      messageListElement.current.scrollTo({\r\n        top: messageListElement.current.scrollHeight,\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages, scrollToBottom]);\r\n\r\n  const onFetchMessages = useCallback(\r\n    (offset = 0, prepend = false) => {\r\n        let messages = getMessages(roomId, offset);\r\n        populateUsersFromLoadedMessages(state.users, dispatch, messages);\r\n\r\n        dispatch({\r\n          type: prepend ? \"prepend messages\" : \"set messages\",\r\n          payload: { id: roomId, messages: messages },\r\n        });\r\n        if (prepend) {\r\n          setTimeout(() => {\r\n            scrollToTop();\r\n          }, 10);\r\n        } else {\r\n          scrollToBottom();\r\n        }\r\n      // });\r\n    },\r\n    [dispatch, roomId, scrollToBottom, scrollToTop, state.users]\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (roomId === undefined) {\r\n      return;\r\n    }\r\n    if (messages === undefined) {\r\n      /** Fetch logic goes here */\r\n      onFetchMessages();\r\n    }\r\n  }, [\r\n    messages,\r\n    dispatch,\r\n    roomId,\r\n    state.users,\r\n    state,\r\n    scrollToBottom,\r\n    onFetchMessages,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    if (messageListElement.current) {\r\n      scrollToBottom();\r\n    }\r\n  }, [scrollToBottom, roomId]);\r\n\r\n  const onUserClicked = async (userId) => {\r\n    // const targetUser = state.users[userId];\r\n    // let roomId = targetUser.room;\r\n\r\n    // console.log(\"onUserClick: \" + JSON.stringify(targetUser));\r\n\r\n    // if (roomId === undefined) {\r\n    //   // @ts-ignore\r\n    //   const room = await addRoom(userId, user.id);\r\n    //   roomId = room.id;\r\n    //   /** We need to set this room id to user. */\r\n    //   dispatch({ type: \"set user\", payload: { ...targetUser, room: roomId } });\r\n    //   /** Then a new room should be added to the store. */\r\n    //   dispatch({\r\n    //     type: \"add room\",\r\n    //     // @ts-ignore\r\n    //     payload: { id: roomId, name: parseRoomName(room.names, user.username) },\r\n    //   });\r\n    // }\r\n    // /** Then a room should be changed */\r\n    // dispatch({ type: \"set current room\", payload: roomId });\r\n  };\r\n\r\n  const onLoadMoreMessages = useCallback(() => {\r\n    onFetchMessages(room.offset, true);\r\n  }, [onFetchMessages, room]);\r\n\r\n  return {\r\n    onLoadMoreMessages,\r\n    onUserClicked,\r\n    message,\r\n    setMessage,\r\n    dispatch,\r\n    room,\r\n    rooms: state.rooms,\r\n    currentRoom: state.currentRoom,\r\n    messageListElement,\r\n    roomId,\r\n    users: state.users,\r\n    messages,\r\n  };\r\n};\r\nexport default useChatHandlers;","// @ts-check\r\nimport React from \"react\";\r\nimport ChatList from \"./components/ChatList\";\r\nimport MessageList from \"./components/MessageList\";\r\nimport TypingArea from \"./components/TypingArea\";\r\nimport useChatHandlers from \"./use-chat-handlers\";\r\n\r\nexport default function Chat({ onLogOut, user, onMessageSend }) {\r\n  const {\r\n    onLoadMoreMessages,\r\n    onUserClicked,\r\n    message,\r\n    setMessage,\r\n    rooms,\r\n    room,\r\n    currentRoom,\r\n    dispatch,\r\n    messageListElement,\r\n    roomId,\r\n    messages,\r\n    users,\r\n  } = useChatHandlers(user);\r\n\r\n  return (\r\n    <div className=\"container py-4 px-5\">\r\n      <div className=\"chat-body row overflow-hidden shadow bg-light rounded\">\r\n        <div className=\"col-8 px-0 flex-column bg-white rounded-lg\">\r\n          <div className=\"px-4 py-4\" style={{ borderBottom: \"1px solid green\" }}>\r\n            <h2 className=\"font-size-15 mb-0\">{room ? room.name : \"Chat Room\"}</h2>\r\n          </div>\r\n          <MessageList\r\n            messageListElement={messageListElement}\r\n            messages={messages}\r\n            room={room}\r\n            onLoadMoreMessages={onLoadMoreMessages}\r\n            user={user}\r\n            onUserClicked={onUserClicked}\r\n            users={users}\r\n          />\r\n\r\n          <TypingArea\r\n            message={message}\r\n            setMessage={setMessage}\r\n            onSubmit={(e) => {\r\n              e.preventDefault();\r\n              onMessageSend(message.trim(), roomId);\r\n              setMessage(\"\");\r\n\r\n              messageListElement.current.scrollTop = messageListElement.current.scrollHeight;\r\n            }}\r\n          />\r\n        </div>\r\n        <div className=\"col-4 px-0\">\r\n          <ChatList\r\n            user={user}\r\n            onLogOut={onLogOut}\r\n            rooms={rooms}\r\n            currentRoom={currentRoom}\r\n            dispatch={dispatch}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","// @ts-check\r\nimport React from \"react\";\r\n\r\nexport function LoadingScreen() {\r\n  return (\r\n    <div className=\"centered-box\">\r\n      <div className=\"spinner-border\" role=\"status\">\r\n        <span className=\"visually-hidden\" />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","// @ts-check\r\nimport React, { useEffect, useState } from \"react\";\r\n\r\nconst Navbar = ({ showLogin }) => {\r\n  /**\r\n   * @type {[{\r\n   *  heroku?: string;\r\n   *  google_cloud?: string;\r\n   *  vercel?: string;\r\n   *  github?: string;\r\n   *  }, React.Dispatch<any>]}\r\n   */\r\n  return (\r\n    <nav className=\"navbar navbar-expand-lg navbar-light d-flex justify-content-between\">\r\n      <span className=\"navbar-brand\">Chat Application</span>\r\n      {showLogin? <a href=\"https://https://github.com/trungIsOnGithhub\">Github</a> : <></>}\r\n    </nav>\r\n  );\r\n};\r\n\r\nexport default Navbar;\r\n","// @ts-check\r\nimport { useEffect, useState } from \"react\";\r\nimport { getMe, login, logOut } from \"./api\";\r\n\r\n\r\n/** User management hook. */\r\nconst useUser = (onUserLoaded = (user) => { }, dispatch) => {\r\n  const [loading, setLoading] = useState(true);\r\n  const [user, setUser] = useState(null);\r\n  /** Callback used in log in form. */\r\n  const onLogIn = (\r\n    username = \"\",\r\n    password = \"\",\r\n    onError = (val = null) => { },\r\n    onLoading = (loading = false) => { }\r\n  ) => {\r\n    onError(null);\r\n    onLoading(true);\r\n    setUser(login(username, password));\r\n      // .then((x) => {\r\n      //   setUser(x);\r\n      //   onLoading(false);\r\n      // })\r\n      // .catch((e) => {\r\n      //   onError(e.message);\r\n      //   onLoading(false);\r\n      // });\r\n  };\r\n\r\n  /** Log out form */\r\n  const onLogOut = async () => {\r\n    // logOut().then(() => {\r\n      setUser(null);\r\n      /** This will clear the store, to completely re-initialize an app on the next login. */\r\n      // dispatch({ type: \"clear\" });\r\n      // setLoading(true);\r\n    // });\r\n  };\r\n\r\n  /** Runs once when the component is mounted to check if there's user stored in cookies */\r\n  useEffect(() => {\r\n    if (!loading) {\r\n      return;\r\n    }\r\n    getMe().then((user) => {\r\n      setUser(user);\r\n      setLoading(false);\r\n      onUserLoaded(user);\r\n    });\r\n  }, [onUserLoaded, loading]);\r\n\r\n  return { user: typeof user === \"string\" ? null : user, onLogIn, onLogOut, loading };\r\n};\r\n\r\nexport {\r\n  useUser\r\n};","// @ts-check\r\nimport { useCallback, useEffect, useRef, useState } from \"react\";\r\n// eslint-disable-next-line no-unused-vars\r\nimport io, { Socket } from \"socket.io-client\";\r\nimport { emitMessage,\r\n  // getEventSource \r\n} from \"./api\";\r\nimport { parseRoomName } from \"./utils\";\r\n/**\r\n * @param {import('./state').UserEntry} newUser\r\n */\r\nconst updateUser = (newUser, user, dispatch, infoMessage) => {\r\n  if (user.username === newUser.username) {\r\n    return;\r\n  }\r\n  dispatch({ type: \"set user\", payload: newUser });\r\n  if (infoMessage !== undefined) {\r\n    dispatch({\r\n      type: \"append message\",\r\n      payload: {\r\n        id: \"0\",\r\n        message: {\r\n          /** Date isn't shown in the info message, so we only need a unique value */\r\n          date: Math.random() * 10000,\r\n          from: \"info\",\r\n          message: infoMessage,\r\n        },\r\n      },\r\n    });\r\n  }\r\n};\r\n\r\n\r\nconst onShowRoom = (room, username, dispatch) => dispatch({\r\n  type: \"add room\",\r\n  payload: {\r\n    id: room.id,\r\n    name: parseRoomName(room.names, username),\r\n  },\r\n});\r\n\r\nconst onMessage = (message, dispatch) => {\r\n  dispatch({\r\n    type: \"make user online\",\r\n    payload: message.from,\r\n  });\r\n  dispatch({\r\n    type: \"append message\",\r\n    payload: { id: message.roomId === undefined ? \"0\" : message.roomId, message },\r\n  });\r\n};\r\n\r\n/** @returns {[Socket, boolean, () => void]} */\r\nconst useSocket = (user, dispatch, onLogOutBase) => {\r\n  const [connected, setConnected] = useState(false);\r\n  const eventSourceRef = useRef(null);\r\n\r\n  const emit = useCallback(async (type, message) => {\r\n    console.log(\"]]]]]]\" + JSON.stringify(type));\r\n    console.log(\"]]]]]]\" + JSON.stringify(user));\r\n    console.log(\"]]]]]]\" + JSON.stringify(message));\r\n    // await emitMessage(type, user, message);\r\n    dispatch({\r\n      type: \"append message\",\r\n      payload: { id: message.roomId === undefined ? \"0\" : message.roomId, message },\r\n    });\r\n    return {};\r\n  }, [user]);\r\n\r\n  const onLogOut = useCallback(async () => {\r\n    await emit(\"user.disconnected\", user);\r\n    onLogOutBase();\r\n  }, [onLogOutBase, emit, user]);\r\n\r\n  /** First of all it's necessary to handle the socket io connection */\r\n  // useEffect(() => {\r\n  //   if (user === null) {\r\n  //     setConnected(false);\r\n\r\n  //     if (eventSourceRef.current !== null) {\r\n\r\n  //       // window.onbeforeunload = undefined;\r\n  //       eventSourceRef.current.close();\r\n  //       eventSourceRef.current = null;\r\n  //     }\r\n  //   } else {\r\n  //     if (eventSourceRef.current === null) {\r\n  //       // eventSourceRef.current = getEventSource(user.id);\r\n  //       eventSourceRef.current.onmessage = function (event) {\r\n  //         const { type, data } = JSON.parse(event.data);\r\n\r\n  //         console.log(\"%%%%%%%>\" + type);\r\n  //         console.log(\"%%%%%%%>\"+  data);\r\n\r\n  //         switch (type) {\r\n  //           case \"user.connected\": updateUser(data, user, dispatch, `${data.username} connected`);\r\n  //             break;\r\n  //           case \"user.disconnected\": updateUser(data, user, dispatch, `${data.username} left`);\r\n  //             break;\r\n  //           case \"show.room\": onShowRoom(data, user.username, dispatch);\r\n  //             break;\r\n  //           case 'message': onMessage(data, dispatch);\r\n  //             break;\r\n  //           default:\r\n  //             break;\r\n  //         }\r\n  //       };\r\n\r\n  //       // window.onbeforeunload = () => {\r\n  //       //   if (eventSourceRef.current) {\r\n  //       //     eventSourceRef.current.close();\r\n  //       //   }\r\n  //       //   emit(\"user.disconnected\", user);\r\n  //       //   return undefined;\r\n  //       // };\r\n\r\n  //       // emit(\"user.connected\", user);\r\n  //     }\r\n\r\n  //     setConnected(true);\r\n\r\n  //   }\r\n  // }, [user, dispatch, onLogOut, emit]);\r\n\r\n\r\n  return [\r\n    {\r\n      // @ts-ignore\r\n      emit\r\n    }\r\n    , connected, onLogOut];\r\n};\r\n\r\nexport { useSocket };\r\n","import React, { useEffect, useCallback } from \"react\";\r\nimport Login from \"./components/Login\";\r\nimport Chat from \"./components/Chat\";\r\nimport { getOnlineUsers, getRooms } from \"./api\";\r\nimport useAppStateContext, { AppContext } from \"./state\";\r\nimport moment from \"moment\";\r\nimport { parseRoomName } from \"./utils\";\r\nimport { LoadingScreen } from \"./components/LoadingScreen\";\r\nimport Navbar from \"./components/Navbar\";\r\nimport { useUser } from \"./hooks\";\r\nimport { useSocket } from \"./use-socket\";\r\n\r\nconst App = () => {\r\n  const {\r\n    loading,\r\n    user,\r\n    state,\r\n    dispatch,\r\n    onLogIn,\r\n    onMessageSend,\r\n    onLogOut,\r\n  } = useAppHandlers();\r\n\r\n  if (loading) {\r\n    return <LoadingScreen />;\r\n  }\r\n\r\n  const showLogin = !user;\r\n\r\n  // https://www.reddit.com/r/ProgrammerHumor/comments/108auwz/guys_i_want_to_put_a_funny_programming_quote_on/\r\n  window.sessionStorage.setItem(\"allMessages\", JSON.stringify({\r\n    \"0\": [{\"from\":\"1\",\"date\":1697094148,\"message\":\"There are 10 types of people: those who understand binary and those who dont\",\"roomId\":\"0\"},{\"from\":\"1\",\"date\":1697094348,\"message\":\"\",\"roomId\":\"0\"},{\"from\":\"3\",\"date\":1697094548,\"message\":\"In a room full of top software designers, if two agree on same thing, thats a majority.\",\"roomId\":\"0\"},{\"from\":\"4\",\"date\":1700123793,\"message\":\"There are two ways to write error-free programs; only the third one works.\",\"roomId\":\"1:4\"}],\r\n    \"1:4\": [{\"from\":\"4\",\"date\":1697093948,\"message\":\"boss make a dollar; I make a dime; that's why my algorithms run in exponential time\",\"roomId\":\"0\"},{\"from\":\"4\",\"date\":1697094704,\"message\":\"There are two ways to write error-free programs; only the third one works.\",\"roomId\":\"1:4\"},{\"from\":\"1\",\"date\":1697094746,\"message\":\"A user interface is like a joke. If you have to explain it, its not that good \",\"roomId\":\"1:4\"}],\r\n    \"1:2\": [{\"from\":\"1\",\"date\":1697094746,\"message\":\"A user interface is like a joke. If you have to explain it, its not that good \",\"roomId\":\"0\"},{\"from\":\"1\",\"date\":1700127951,\"message\":\"Before software can be reusable it first has to be usable\",\"roomId\":\"0\"},{\"from\":\"1\",\"date\":1700127958,\"message\":\"If one programmer can do it in one week, then 2 programmers can do it in 2 weeks!\",\"roomId\":\"0\"},{\"from\":\"2\",\"date\":1700126273,\"message\":\"Programming is the art of adding bugs to an empty text file.\",\"roomId\":\"1:2\"}],\r\n    \"2:3\": [{\"from\":\"3\",\"date\":1697094544,\"message\":\"I told him I can't open the JAR, and he said go download Java \",\"roomId\":\"2:3\"},{\"from\":\"2\",\"date\":1697094585,\"message\":\"In order to understand recursion, one must first understand recursion \",\"roomId\":\"2:3\"}],\r\n    \"2:4\": [{\"from\":\"4\",\"date\":1697094685,\"message\":\"A good programmer is someone who always looks both ways before crossing a one-way street.\",\"roomId\":\"2:4\"},{\"from\":\"2\",\"date\":1697094738,\"message\":\"The trouble is that you can never tell what a programmer is doing until its too late.\",\"roomId\":\"2:4\"}],\r\n    \"1:3\": [{\"from\":\"3\",\"date\":1697093948,\"message\":\"The computer was born to solve problems that did not exist before.\",\"roomId\":\"1:3\"},{\"from\":\"1\",\"date\":1697094704,\"message\":\"UNIX is user friendly. Its just very particular about who its friends are.\",\"roomId\":\"1:3\"}],\r\n    \"3:4\": [{\"from\":\"3\",\"date\":1697093948,\"message\":\"There is an easy way and a hard way. The hard part is finding the easy way. \",\"roomId\":\"3:4\"},{\"from\":\"4\",\"date\":1697094704,\"message\":\"When your hammer is C++, everything begins to look like a thumb.\",\"roomId\":\"3:4\"}]\r\n  }));\r\n\r\n\r\n  return (\r\n    <AppContext.Provider value={[state, dispatch]}>\r\n      <div\r\n        className={`full-height ${showLogin ? \"bg-light\" : \"\"}`}\r\n        style={{\r\n          backgroundColor: !showLogin ? \"#495057\" : undefined,\r\n        }}\r\n      >\r\n        <Navbar showLogin={showLogin}/>\r\n        {showLogin ? (\r\n          <Login onLogIn={onLogIn} />\r\n        ) : (\r\n          <Chat user={user} onMessageSend={onMessageSend} onLogOut={onLogOut} />\r\n        )}\r\n      </div>\r\n    </AppContext.Provider>\r\n  );\r\n};\r\n\r\nconst useAppHandlers = () => {\r\n  const [state, dispatch] = useAppStateContext();\r\n  const onUserLoaded = useCallback(\r\n    (user) => {\r\n      if (user !== null) {\r\n        if (!state.users[user.id]) {\r\n          dispatch({ type: \"set user\", payload: { ...user, online: true } });\r\n        }\r\n      }\r\n    },\r\n    [dispatch, state.users]\r\n  );\r\n\r\n  const { user, onLogIn, onLogOut: onLogOutA, loading } = useUser(\r\n    onUserLoaded,\r\n    dispatch\r\n  );\r\n  const [socket, connected, onLogOut] = useSocket(user, dispatch, onLogOutA);\r\n\r\n  useEffect(() => {\r\n    if (user === null) {\r\n      return;\r\n    }\r\n    if (connected) {\r\n      const newRooms = [];\r\n      Object.keys(state.rooms).forEach((roomId) => {\r\n        const room = state.rooms[roomId];\r\n        if (room.connected) {\r\n          return;\r\n        }\r\n        newRooms.push({ ...room, connected: true });\r\n      });\r\n      if (newRooms.length !== 0) {\r\n        dispatch({ type: \"set rooms\", payload: newRooms });\r\n      }\r\n    } else {\r\n      /**\r\n       * It's necessary to set disconnected flags on rooms\r\n       * once the client is not connected\r\n       */\r\n      const newRooms = [];\r\n      Object.keys(state.rooms).forEach((roomId) => {\r\n        const room = state.rooms[roomId];\r\n        if (!room.connected) {\r\n          return;\r\n        }\r\n        newRooms.push({ ...room, connected: false });\r\n      });\r\n      /** Only update the state if it's only necessary */\r\n      if (newRooms.length !== 0) {\r\n        dispatch({ type: \"set rooms\", payload: newRooms });\r\n      }\r\n    }\r\n  }, [user, connected, dispatch, socket, state.rooms, state.users]);\r\n\r\n  /** Populate default rooms when user is not null */\r\n  useEffect(() => {\r\n    if (Object.values(state.rooms).length === 0 && user !== null) {\r\n      let users = getOnlineUsers();\r\n      // .then((users) => {\r\n        // dispatch({\r\n        //   type: \"append users\",\r\n        //   payload: users,\r\n        // });\r\n      // });\r\n  \r\n      let rooms = getRooms(user.id);\r\n        const payload = [];\r\n        rooms.forEach(({ id, names }) => {\r\n          payload.push({ id, name: parseRoomName(names, user.username) });\r\n        });\r\n        /** Here we also can populate the state with default chat rooms */\r\n        dispatch({\r\n          type: \"set rooms\",\r\n          payload,\r\n        });\r\n        dispatch({ type: \"set current room\", payload: \"0\" });\r\n    }\r\n  }, [dispatch, state.rooms, user]);\r\n\r\n  const onMessageSend = useCallback(\r\n    (message, roomId) => {\r\n      console.log(\"?????????????__> \" + JSON.stringify(message));\r\n  \r\n      if (typeof message !== \"string\" || message.trim().length === 0) {\r\n        return;\r\n      }\r\n      if (!socket) {\r\n        console.error(\"Couldn't send message\");\r\n      }\r\n      socket.emit(\"message\", {\r\n        roomId: roomId,\r\n        message,\r\n        from: user.id,\r\n        date: moment(new Date()).unix(),\r\n      });\r\n    },\r\n    [user, socket]\r\n  );\r\n\r\n  return {\r\n    loading,\r\n    user,\r\n    state,\r\n    dispatch,\r\n    onLogIn,\r\n    onMessageSend,\r\n    onLogOut,\r\n  };\r\n};\r\n\r\nexport default App;\r\n","import \"bootstrap/dist/css/bootstrap.min.css\";\r\n// import \"./styles/style-overrides.css\";\r\nimport \"./styles/style.css\";\r\nimport \"./styles/font-face.css\";\r\n\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\n\r\nimport App from \"./App\";\r\n\r\nReactDOM.render(<App />, document.getElementById(\"root\"));\r\n"],"sourceRoot":""}